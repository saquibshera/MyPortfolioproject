<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Bookings Admin â€” Saquib Manzoor</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet"/>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#06081a;--card:rgba(255,255,255,0.04);--border:rgba(255,255,255,0.08);
  --text:#f1f5f9;--muted:#94a3b8;--accent:#818cf8;
}
body{background:var(--bg);color:var(--text);font-family:'Inter',sans-serif;min-height:100vh}

/* Login Screen */
#login-screen{display:flex;align-items:center;justify-content:center;min-height:100vh;padding:24px}
.login-box{background:var(--card);border:1px solid var(--border);border-radius:24px;padding:48px;max-width:400px;width:100%;text-align:center}
.login-box h1{font-family:'Syne',sans-serif;font-size:28px;font-weight:800;margin-bottom:8px}
.login-box p{color:var(--muted);font-size:14px;margin-bottom:32px}
.login-input{width:100%;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:14px 18px;color:#fff;font-family:'Inter',sans-serif;font-size:15px;outline:none;transition:border-color .2s;margin-bottom:16px}
.login-input:focus{border-color:rgba(99,102,241,.5)}
.login-input::placeholder{color:rgba(148,163,184,.5)}
.btn-primary{background:linear-gradient(135deg,#6366f1,#8b5cf6);border:none;border-radius:12px;padding:14px 28px;color:#fff;font-size:15px;font-weight:600;cursor:pointer;width:100%;transition:all .2s}
.btn-primary:hover{transform:translateY(-2px);box-shadow:0 0 30px rgba(99,102,241,.4)}
.login-err{color:#f87171;font-size:13px;margin-top:8px;display:none}

/* Main App */
#app{display:none}
.topbar{background:rgba(6,8,26,.9);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:0 24px;height:64px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:10}
.topbar-title{font-family:'Syne',sans-serif;font-size:18px;font-weight:800}
.grad{background:linear-gradient(135deg,#818cf8,#a78bfa,#38bdf8);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.logout-btn{background:rgba(255,255,255,.05);border:1px solid var(--border);border-radius:10px;padding:8px 16px;color:var(--muted);font-size:13px;font-weight:500;cursor:pointer;transition:all .2s}
.logout-btn:hover{color:#fff;border-color:rgba(255,255,255,.2)}

.container{max-width:1200px;margin:0 auto;padding:40px 24px}

/* Stats row */
.stats-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:16px;margin-bottom:40px}
.stat-card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:20px;text-align:center}
.stat-num{font-family:'Syne',sans-serif;font-size:32px;font-weight:800;margin-bottom:4px}
.stat-lbl{font-size:12px;color:var(--muted);font-weight:500;letter-spacing:.3px}

/* Filters */
.filters{display:flex;gap:10px;margin-bottom:24px;flex-wrap:wrap;align-items:center;justify-content:space-between}
.filter-tabs{display:flex;gap:8px;flex-wrap:wrap}
.ftab{background:rgba(255,255,255,.05);border:1px solid var(--border);border-radius:10px;padding:8px 16px;color:var(--muted);font-size:13px;font-weight:600;cursor:pointer;transition:all .2s}
.ftab.active,.ftab:hover{background:rgba(99,102,241,.15);border-color:rgba(99,102,241,.4);color:#a5b4fc}
.search-input{background:rgba(255,255,255,.05);border:1px solid var(--border);border-radius:10px;padding:9px 16px;color:#fff;font-family:'Inter',sans-serif;font-size:13px;outline:none;width:220px;transition:border-color .2s}
.search-input:focus{border-color:rgba(99,102,241,.5)}
.search-input::placeholder{color:rgba(148,163,184,.4)}

/* Table */
.table-wrap{background:var(--card);border:1px solid var(--border);border-radius:20px;overflow:hidden}
table{width:100%;border-collapse:collapse}
thead tr{background:rgba(99,102,241,.08);border-bottom:1px solid var(--border)}
th{padding:14px 18px;text-align:left;font-size:11px;font-weight:700;color:var(--muted);letter-spacing:.8px;text-transform:uppercase;white-space:nowrap}
tbody tr{border-bottom:1px solid rgba(255,255,255,.04);transition:background .15s}
tbody tr:last-child{border-bottom:none}
tbody tr:hover{background:rgba(99,102,241,.04)}
td{padding:14px 18px;font-size:14px;vertical-align:middle}
.td-name{font-weight:600;color:#e2e8f0}
.td-email{color:var(--muted);font-size:13px}
.td-date{color:var(--muted);font-size:12px;white-space:nowrap}
.td-msg{color:var(--muted);font-size:13px;max-width:220px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}

/* Status badges */
.badge{display:inline-flex;align-items:center;gap:5px;border-radius:8px;padding:4px 10px;font-size:11px;font-weight:700;letter-spacing:.3px;cursor:pointer;white-space:nowrap;border:none;font-family:'Inter',sans-serif}
.badge-new{background:rgba(34,211,238,.12);color:#22d3ee;border:1px solid rgba(34,211,238,.25)}
.badge-contacted{background:rgba(251,191,36,.12);color:#fbbf24;border:1px solid rgba(251,191,36,.25)}
.badge-confirmed{background:rgba(52,211,153,.12);color:#34d399;border:1px solid rgba(52,211,153,.25)}
.badge-completed{background:rgba(99,102,241,.12);color:#818cf8;border:1px solid rgba(99,102,241,.25)}

/* Actions */
.action-btn{background:none;border:1px solid rgba(255,255,255,.1);border-radius:8px;padding:6px 10px;color:var(--muted);font-size:12px;cursor:pointer;transition:all .2s;margin-left:4px}
.action-btn:hover{background:rgba(248,113,113,.1);border-color:rgba(248,113,113,.3);color:#f87171}

/* Modal */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(6px);z-index:100;display:none;align-items:center;justify-content:center;padding:24px}
.modal-overlay.open{display:flex}
.modal{background:#0d1030;border:1px solid var(--border);border-radius:24px;padding:36px;max-width:580px;width:100%;max-height:90vh;overflow-y:auto}
.modal h2{font-family:'Syne',sans-serif;font-size:20px;font-weight:700;margin-bottom:20px}
.modal-row{margin-bottom:14px}
.modal-label{font-size:11px;font-weight:700;color:var(--muted);letter-spacing:.6px;text-transform:uppercase;margin-bottom:4px}
.modal-value{font-size:14px;color:#e2e8f0;line-height:1.6}
.modal-msg{background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:12px;padding:14px;font-size:14px;color:#e2e8f0;line-height:1.7;white-space:pre-wrap}
.modal-close{background:rgba(255,255,255,.05);border:1px solid var(--border);border-radius:10px;padding:10px 22px;color:var(--muted);font-size:14px;font-weight:600;cursor:pointer;transition:all .2s;margin-top:20px}
.modal-close:hover{color:#fff}

/* Status selector */
.status-select{background:rgba(255,255,255,.05);border:1px solid var(--border);border-radius:10px;padding:8px 12px;color:#fff;font-family:'Inter',sans-serif;font-size:13px;outline:none;cursor:pointer;margin-top:12px;width:100%}
.status-select option{background:#0d1030}

/* Empty state */
.empty{text-align:center;padding:80px 20px;color:var(--muted)}
.empty-icon{font-size:48px;margin-bottom:16px}
.empty h3{font-family:'Syne',sans-serif;font-size:18px;font-weight:700;margin-bottom:8px;color:#e2e8f0}

/* Export btn */
.export-btn{background:rgba(52,211,153,.1);border:1px solid rgba(52,211,153,.25);border-radius:10px;padding:9px 16px;color:#34d399;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s}
.export-btn:hover{background:rgba(52,211,153,.2)}

.no-results{text-align:center;padding:48px;color:var(--muted);font-size:14px}

@media(max-width:768px){
  .container{padding:20px 16px}
  th:nth-child(4),td:nth-child(4),
  th:nth-child(5),td:nth-child(5){display:none}
  .search-input{width:140px}
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login-screen">
  <div class="login-box">
    <div style="font-size:48px;margin-bottom:16px">ğŸ”</div>
    <h1 class="grad">Admin Panel</h1>
    <p>Saquib Manzoor Â· Booking Dashboard</p>
    <input class="login-input" type="password" id="pwd-input" placeholder="Enter admin password" onkeydown="if(event.key==='Enter')doLogin()"/>
    <button class="btn-primary" onclick="doLogin()">Access Dashboard</button>
    <div class="login-err" id="login-err">Incorrect password. Try again.</div>
  </div>
</div>

<!-- MAIN APP -->
<div id="app">
  <div class="topbar">
    <div class="topbar-title">ğŸ“‹ <span class="grad">Bookings Dashboard</span></div>
    <div style="display:flex;gap:10px;align-items:center">
      <button class="export-btn" onclick="exportCSV()">â¬‡ Export CSV</button>
      <button class="logout-btn" onclick="doLogout()">Logout</button>
    </div>
  </div>

  <div class="container">
    <!-- Stats -->
    <div class="stats-row" id="stats-row">
      <div class="stat-card"><div class="stat-num grad" id="stat-total">â€”</div><div class="stat-lbl">Total Bookings</div></div>
      <div class="stat-card"><div class="stat-num" style="color:#22d3ee" id="stat-new">â€”</div><div class="stat-lbl">New</div></div>
      <div class="stat-card"><div class="stat-num" style="color:#fbbf24" id="stat-contacted">â€”</div><div class="stat-lbl">Contacted</div></div>
      <div class="stat-card"><div class="stat-num" style="color:#34d399" id="stat-confirmed">â€”</div><div class="stat-lbl">Confirmed</div></div>
      <div class="stat-card"><div class="stat-num" style="color:#818cf8" id="stat-completed">â€”</div><div class="stat-lbl">Completed</div></div>
    </div>

    <!-- Filters -->
    <div class="filters">
      <div class="filter-tabs">
        <button class="ftab active" onclick="setFilter('all',this)">All</button>
        <button class="ftab" onclick="setFilter('new',this)">ğŸ”µ New</button>
        <button class="ftab" onclick="setFilter('contacted',this)">ğŸŸ¡ Contacted</button>
        <button class="ftab" onclick="setFilter('confirmed',this)">ğŸŸ¢ Confirmed</button>
        <button class="ftab" onclick="setFilter('completed',this)">ğŸŸ£ Completed</button>
      </div>
      <input class="search-input" id="search-input" placeholder="ğŸ” Search name / email..." oninput="renderTable()"/>
    </div>

    <!-- Table -->
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Name / Company</th>
            <th>Email / Phone</th>
            <th>Training Type</th>
            <th>Preferred Date</th>
            <th>Received</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="bookings-tbody"></tbody>
      </table>
      <div id="no-results" class="no-results" style="display:none">No bookings match your filter.</div>
      <div id="empty-state" class="empty" style="display:none">
        <div class="empty-icon">ğŸ“­</div>
        <h3>No bookings yet</h3>
        <p>Bookings submitted through the contact form will appear here.</p>
      </div>
    </div>
  </div>
</div>

<!-- DETAIL MODAL -->
<div class="modal-overlay" id="modal-overlay" onclick="if(event.target===this)closeModal()">
  <div class="modal" id="modal-content">
    <h2>ğŸ“„ Booking Details</h2>
    <div id="modal-body"></div>
    <button class="modal-close" onclick="closeModal()">Close</button>
  </div>
</div>

<script>
const API = 'http://localhost:3000/api';
let adminKey = '';
let allBookings = [];
let currentFilter = 'all';

// â”€â”€ Auth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function doLogin() {
  const pwd = document.getElementById('pwd-input').value.trim();
  if (!pwd) return;
  adminKey = pwd;
  fetchBookings();
}

function doLogout() {
  adminKey = '';
  allBookings = [];
  document.getElementById('login-screen').style.display = 'flex';
  document.getElementById('app').style.display = 'none';
  document.getElementById('pwd-input').value = '';
}

// â”€â”€ Fetch â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fetchBookings() {
  try {
    const res = await fetch(`${API}/bookings?key=${encodeURIComponent(adminKey)}`);
    if (res.status === 401) {
      document.getElementById('login-err').style.display = 'block';
      adminKey = '';
      return;
    }
    const data = await res.json();
    allBookings = data.bookings || [];
    document.getElementById('login-err').style.display = 'none';
    document.getElementById('login-screen').style.display = 'none';
    document.getElementById('app').style.display = 'block';
    updateStats();
    renderTable();
  } catch {
    document.getElementById('login-err').textContent = 'Cannot connect to server. Is it running?';
    document.getElementById('login-err').style.display = 'block';
  }
}

// â”€â”€ Stats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateStats() {
  document.getElementById('stat-total').textContent = allBookings.length;
  ['new','contacted','confirmed','completed'].forEach(s => {
    document.getElementById(`stat-${s}`).textContent = allBookings.filter(b => b.status === s).length;
  });
}

// â”€â”€ Filter & Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setFilter(f, el) {
  currentFilter = f;
  document.querySelectorAll('.ftab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  renderTable();
}

function renderTable() {
  const q = document.getElementById('search-input').value.toLowerCase();
  let list = allBookings;
  if (currentFilter !== 'all') list = list.filter(b => b.status === currentFilter);
  if (q) list = list.filter(b =>
    b.name.toLowerCase().includes(q) ||
    b.email.toLowerCase().includes(q) ||
    (b.company||'').toLowerCase().includes(q)
  );

  const tbody = document.getElementById('bookings-tbody');
  document.getElementById('empty-state').style.display = allBookings.length === 0 ? 'block' : 'none';
  document.getElementById('no-results').style.display = (allBookings.length > 0 && list.length === 0) ? 'block' : 'none';

  if (list.length === 0) { tbody.innerHTML = ''; return; }

  tbody.innerHTML = list.map((b, i) => `
    <tr>
      <td style="color:var(--muted);font-size:12px">${allBookings.length - allBookings.indexOf(b)}</td>
      <td>
        <div class="td-name">${esc(b.name)}</div>
        ${b.company ? `<div class="td-email">${esc(b.company)}</div>` : ''}
      </td>
      <td>
        <div style="font-size:13px;color:#a5b4fc">${esc(b.email)}</div>
        ${b.phone ? `<div class="td-email">${esc(b.phone)}</div>` : ''}
      </td>
      <td><div class="td-email">${esc(b.trainingType || b.subject || 'â€”')}</div></td>
      <td><div class="td-date">${esc(b.preferredDate || 'â€”')}</div></td>
      <td><div class="td-date">${fmtDate(b.createdAt)}</div></td>
      <td>
        <select class="badge badge-${b.status}" onchange="updateStatus(${b.id}, this.value)"
          style="background:transparent;cursor:pointer;padding:4px 8px;font-size:11px;font-weight:700;border-radius:8px;outline:none">
          <option value="new" ${b.status==='new'?'selected':''}>ğŸ”µ New</option>
          <option value="contacted" ${b.status==='contacted'?'selected':''}>ğŸŸ¡ Contacted</option>
          <option value="confirmed" ${b.status==='confirmed'?'selected':''}>ğŸŸ¢ Confirmed</option>
          <option value="completed" ${b.status==='completed'?'selected':''}>ğŸŸ£ Completed</option>
        </select>
      </td>
      <td style="white-space:nowrap">
        <button class="action-btn" style="color:#a5b4fc;border-color:rgba(165,180,252,.2)" onclick="openModal(${b.id})">ğŸ‘ View</button>
        <button class="action-btn" onclick="deleteBooking(${b.id})">ğŸ—‘</button>
      </td>
    </tr>
  `).join('');
}

// â”€â”€ Update Status â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function updateStatus(id, status) {
  await fetch(`${API}/bookings/${id}?key=${encodeURIComponent(adminKey)}`, {
    method: 'PATCH', headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ status })
  });
  const b = allBookings.find(b => b.id === id);
  if (b) b.status = status;
  updateStats();
  renderTable();
}

// â”€â”€ Delete â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function deleteBooking(id) {
  if (!confirm('Delete this booking?')) return;
  await fetch(`${API}/bookings/${id}?key=${encodeURIComponent(adminKey)}`, { method: 'DELETE' });
  allBookings = allBookings.filter(b => b.id !== id);
  updateStats();
  renderTable();
}

// â”€â”€ Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(id) {
  const b = allBookings.find(b => b.id === id);
  if (!b) return;
  document.getElementById('modal-body').innerHTML = `
    <div class="modal-row"><div class="modal-label">Name</div><div class="modal-value">${esc(b.name)}</div></div>
    <div class="modal-row"><div class="modal-label">Email</div><div class="modal-value"><a href="mailto:${esc(b.email)}" style="color:#818cf8">${esc(b.email)}</a></div></div>
    ${b.phone ? `<div class="modal-row"><div class="modal-label">Phone</div><div class="modal-value">${esc(b.phone)}</div></div>` : ''}
    ${b.company ? `<div class="modal-row"><div class="modal-label">Company</div><div class="modal-value">${esc(b.company)}</div></div>` : ''}
    <div class="modal-row"><div class="modal-label">Training Type</div><div class="modal-value">${esc(b.trainingType || b.subject || 'â€”')}</div></div>
    ${b.preferredDate ? `<div class="modal-row"><div class="modal-label">Preferred Date</div><div class="modal-value">${esc(b.preferredDate)}</div></div>` : ''}
    <div class="modal-row"><div class="modal-label">Submitted</div><div class="modal-value">${fmtDateFull(b.createdAt)}</div></div>
    <div class="modal-row"><div class="modal-label">Message</div><div class="modal-msg">${esc(b.message)}</div></div>
    <div class="modal-row">
      <div class="modal-label">Status</div>
      <select class="status-select" onchange="updateStatus(${b.id}, this.value)">
        <option value="new" ${b.status==='new'?'selected':''}>ğŸ”µ New</option>
        <option value="contacted" ${b.status==='contacted'?'selected':''}>ğŸŸ¡ Contacted</option>
        <option value="confirmed" ${b.status==='confirmed'?'selected':''}>ğŸŸ¢ Confirmed</option>
        <option value="completed" ${b.status==='completed'?'selected':''}>ğŸŸ£ Completed</option>
      </select>
    </div>
  `;
  document.getElementById('modal-overlay').classList.add('open');
}

function closeModal() {
  document.getElementById('modal-overlay').classList.remove('open');
}

// â”€â”€ Export CSV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function exportCSV() {
  const headers = ['ID','Name','Email','Phone','Company','Training Type','Preferred Date','Subject','Message','Status','Submitted At'];
  const rows = allBookings.map(b => [
    b.id, b.name, b.email, b.phone||'', b.company||'',
    b.trainingType||'', b.preferredDate||'', b.subject||'',
    b.message.replace(/\n/g,' '), b.status, b.createdAt
  ].map(v => `"${String(v).replace(/"/g,'""')}"`).join(','));
  const csv = [headers.join(','), ...rows].join('\n');
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([csv], {type:'text/csv'}));
  a.download = `bookings_${new Date().toISOString().slice(0,10)}.csv`;
  a.click();
}

// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function esc(s) {
  return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}
function fmtDate(iso) {
  if (!iso) return 'â€”';
  const d = new Date(iso);
  return d.toLocaleDateString('en-GB',{day:'2-digit',month:'short',year:'numeric'});
}
function fmtDateFull(iso) {
  if (!iso) return 'â€”';
  const d = new Date(iso);
  return d.toLocaleString('en-GB',{day:'2-digit',month:'short',year:'numeric',hour:'2-digit',minute:'2-digit'});
}
</script>
</body>
</html>
